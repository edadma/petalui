---
import ComponentLayout from '../../layouts/ComponentLayout.astro';
import Example from '../../components/Example.astro';
import {
  BasicDemo,
  MultipleDemo,
  CheckableDemo,
  SearchableDemo,
  SizesDemo,
  StatusDemo,
  AsyncLoadDemo,
  MaxTagDemo,
  TreeLineDemo,
  DisabledItemsDemo,
} from '../../components/TreeSelectDemo';
import TreeSelectDemoSource from '../../components/TreeSelectDemo.tsx?raw';

const api = [
  { property: 'treeData', description: 'Tree data structure', type: 'TreeDataNode[]', default: '[]' },
  { property: 'value', description: 'Selected value(s)', type: 'string | string[]', default: '-' },
  { property: 'defaultValue', description: 'Default selected value(s)', type: 'string | string[]', default: '[]' },
  { property: 'onChange', description: 'Callback when selection changes', type: '(value: string | string[], labels: ReactNode[]) => void', default: '-' },
  { property: 'multiple', description: 'Allow multiple selection', type: 'boolean', default: 'false' },
  { property: 'treeCheckable', description: 'Show checkbox for tree nodes', type: 'boolean', default: 'false' },
  { property: 'treeCheckStrictly', description: 'Check without parent-child association', type: 'boolean', default: 'false' },
  { property: 'showCheckedStrategy', description: 'How to display checked items', type: "'SHOW_ALL' | 'SHOW_PARENT' | 'SHOW_CHILD'", default: "'SHOW_ALL'" },
  { property: 'showSearch', description: 'Enable search functionality', type: 'boolean', default: 'false' },
  { property: 'searchValue', description: 'Controlled search input value', type: 'string', default: '-' },
  { property: 'onSearch', description: 'Callback when search input changes', type: '(value: string) => void', default: '-' },
  { property: 'filterTreeNode', description: 'Custom filter function', type: '(searchValue: string, node: TreeDataNode) => boolean', default: '-' },
  { property: 'placeholder', description: 'Placeholder text', type: 'string', default: "'Please select'" },
  { property: 'allowClear', description: 'Show clear button', type: 'boolean', default: 'true' },
  { property: 'disabled', description: 'Disable the select', type: 'boolean', default: 'false' },
  { property: 'size', description: 'Size of the input', type: "'xs' | 'sm' | 'md' | 'lg' | 'xl'", default: "'md'" },
  { property: 'color', description: 'Color theme', type: "'primary' | 'secondary' | 'accent' | 'info' | 'success' | 'warning' | 'error'", default: '-' },
  { property: 'status', description: 'Validation status', type: "'error' | 'warning'", default: '-' },
  { property: 'maxTagCount', description: 'Max number of tags to show', type: "number | 'responsive'", default: '-' },
  { property: 'maxTagPlaceholder', description: 'Content for hidden tags', type: 'ReactNode | ((omittedValues: string[]) => ReactNode)', default: '-' },
  { property: 'treeLine', description: 'Show connecting lines', type: 'boolean', default: 'false' },
  { property: 'treeDefaultExpandAll', description: 'Expand all tree nodes by default', type: 'boolean', default: 'false' },
  { property: 'treeDefaultExpandedKeys', description: 'Default expanded tree node keys', type: 'string[]', default: '[]' },
  { property: 'treeExpandedKeys', description: 'Controlled expanded tree node keys', type: 'string[]', default: '-' },
  { property: 'onTreeExpand', description: 'Callback when tree nodes expand/collapse', type: '(expandedKeys: string[]) => void', default: '-' },
  { property: 'loadData', description: 'Load data asynchronously', type: '(node: TreeDataNode) => Promise<void>', default: '-' },
  { property: 'fieldNames', description: 'Customize field names', type: '{ label?: string; value?: string; children?: string }', default: '-' },
  { property: 'open', description: 'Controlled dropdown visibility', type: 'boolean', default: '-' },
  { property: 'onDropdownVisibleChange', description: 'Callback when dropdown visibility changes', type: '(open: boolean) => void', default: '-' },
  { property: 'suffixIcon', description: 'Custom suffix icon', type: 'ReactNode', default: '-' },
  { property: 'switcherIcon', description: 'Custom expand/collapse icon', type: 'ReactNode | ((props: { expanded: boolean }) => ReactNode)', default: '-' },
  { property: 'notFoundContent', description: 'Content when no results', type: 'ReactNode', default: "'No results found'" },
  { property: 'dropdownRender', description: 'Custom dropdown content renderer', type: '(menu: ReactNode) => ReactNode', default: '-' },
  { property: 'popupClassName', description: 'Class for dropdown', type: 'string', default: '-' },
  { property: 'data-testid', description: 'Test ID for the component', type: 'string', default: "'treeselect'" },
  { property: 'className', description: 'Additional CSS classes', type: 'string', default: '-' },
];

const treeDataNodeApi = [
  { property: 'key', description: 'Unique identifier', type: 'string', default: '-' },
  { property: 'title', description: 'Display text', type: 'ReactNode', default: '-' },
  { property: 'children', description: 'Child nodes', type: 'TreeDataNode[]', default: '-' },
  { property: 'disabled', description: 'Whether disabled', type: 'boolean', default: '-' },
  { property: 'isLeaf', description: 'Whether this is a leaf node', type: 'boolean', default: '-' },
];

const apiTables = [
  { title: 'TreeSelect Props', data: api },
  { title: 'TreeDataNode', data: treeDataNodeApi },
];
---

<ComponentLayout
  name="TreeSelect"
  description="Dropdown tree selection for hierarchical data."
  api={apiTables}
>
  <Example title="Basic TreeSelect" description="Select a single value from a tree structure." source={TreeSelectDemoSource} fn="BasicDemo">
    <BasicDemo client:load slot="demo" />
  </Example>

  <Example title="Multiple Selection" description="Select multiple values from the tree." source={TreeSelectDemoSource} fn="MultipleDemo">
    <MultipleDemo client:load slot="demo" />
  </Example>

  <Example title="Checkable" description="Use checkboxes for selection with parent-child association." source={TreeSelectDemoSource} fn="CheckableDemo">
    <CheckableDemo client:load slot="demo" />
  </Example>

  <Example title="Searchable" description="Filter tree nodes with search." source={TreeSelectDemoSource} fn="SearchableDemo">
    <SearchableDemo client:load slot="demo" />
  </Example>

  <Example title="Sizes" description="TreeSelect comes in various sizes." source={TreeSelectDemoSource} fn="SizesDemo">
    <SizesDemo client:load slot="demo" />
  </Example>

  <Example title="Validation Status" description="Show error or warning states." source={TreeSelectDemoSource} fn="StatusDemo">
    <StatusDemo client:load slot="demo" />
  </Example>

  <Example title="Async Loading" description="Load tree nodes asynchronously when expanded." source={TreeSelectDemoSource} fn="AsyncLoadDemo">
    <AsyncLoadDemo client:load slot="demo" />
  </Example>

  <Example title="Max Tag Count" description="Limit the number of visible tags." source={TreeSelectDemoSource} fn="MaxTagDemo">
    <MaxTagDemo client:load slot="demo" />
  </Example>

  <Example title="Tree Line" description="Show connecting lines between tree nodes." source={TreeSelectDemoSource} fn="TreeLineDemo">
    <TreeLineDemo client:load slot="demo" />
  </Example>

  <Example title="Disabled Items" description="Some tree nodes can be disabled." source={TreeSelectDemoSource} fn="DisabledItemsDemo">
    <DisabledItemsDemo client:load slot="demo" />
  </Example>

  <section slot="accessibility" class="mb-8">
    <h2 class="text-2xl font-bold mb-4">Accessibility</h2>
    <p class="text-base-content/80 mb-4">
      The TreeSelect component follows WAI-ARIA combobox and tree patterns with proper ARIA attributes and keyboard navigation.
    </p>
    <h3 class="text-xl font-semibold mb-3">Keyboard Navigation</h3>
    <div class="overflow-x-auto">
      <table class="table table-zebra w-full">
        <thead>
          <tr>
            <th>Key</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><kbd class="kbd kbd-sm">Enter / Space</kbd></td>
            <td>Open dropdown or select focused item</td>
          </tr>
          <tr>
            <td><kbd class="kbd kbd-sm">Escape</kbd></td>
            <td>Close dropdown</td>
          </tr>
          <tr>
            <td><kbd class="kbd kbd-sm">↓</kbd></td>
            <td>Open dropdown or move focus down</td>
          </tr>
          <tr>
            <td><kbd class="kbd kbd-sm">↑</kbd></td>
            <td>Move focus up</td>
          </tr>
          <tr>
            <td><kbd class="kbd kbd-sm">→</kbd></td>
            <td>Expand focused tree node</td>
          </tr>
          <tr>
            <td><kbd class="kbd kbd-sm">←</kbd></td>
            <td>Collapse focused tree node or move to parent</td>
          </tr>
          <tr>
            <td><kbd class="kbd kbd-sm">Home</kbd></td>
            <td>Move focus to first item</td>
          </tr>
          <tr>
            <td><kbd class="kbd kbd-sm">End</kbd></td>
            <td>Move focus to last item</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3 class="text-xl font-semibold mb-3 mt-6">Testing</h3>
    <p class="text-base-content/80 mb-4">
      The component exposes <code class="bg-base-content/20 px-1 rounded">data-testid</code> and <code class="bg-base-content/20 px-1 rounded">data-state</code> attributes for testing:
    </p>
    <div class="overflow-x-auto">
      <table class="table table-zebra w-full">
        <thead>
          <tr>
            <th>Element</th>
            <th>Test ID</th>
            <th>Data Attributes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Root</td>
            <td><code class="text-sm">{'{baseTestId}'}</code></td>
            <td><code class="text-sm">data-state="open|closed", data-disabled</code></td>
          </tr>
          <tr>
            <td>Trigger</td>
            <td><code class="text-sm">{'{baseTestId}'}-trigger</code></td>
            <td><code class="text-sm">-</code></td>
          </tr>
          <tr>
            <td>Dropdown</td>
            <td><code class="text-sm">{'{baseTestId}'}-dropdown</code></td>
            <td><code class="text-sm">-</code></td>
          </tr>
          <tr>
            <td>Search</td>
            <td><code class="text-sm">{'{baseTestId}'}-search</code></td>
            <td><code class="text-sm">-</code></td>
          </tr>
          <tr>
            <td>Clear</td>
            <td><code class="text-sm">{'{baseTestId}'}-clear</code></td>
            <td><code class="text-sm">-</code></td>
          </tr>
          <tr>
            <td>Option</td>
            <td><code class="text-sm">{'{baseTestId}'}-option-{'{key}'}</code></td>
            <td><code class="text-sm">data-state="selected|unselected", data-disabled</code></td>
          </tr>
          <tr>
            <td>Tag</td>
            <td><code class="text-sm">{'{baseTestId}'}-tag-{'{key}'}</code></td>
            <td><code class="text-sm">-</code></td>
          </tr>
          <tr>
            <td>Empty</td>
            <td><code class="text-sm">{'{baseTestId}'}-empty</code></td>
            <td><code class="text-sm">-</code></td>
          </tr>
        </tbody>
      </table>
    </div>
    <p class="text-base-content/80 mt-4">
      Pass a custom <code class="bg-base-content/20 px-1 rounded">data-testid</code> prop to use a different base ID.
    </p>
  </section>
</ComponentLayout>
