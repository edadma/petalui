---
import Layout from '../../layouts/Layout.astro';
import ApiTable from '../../components/ApiTable.astro';
import { Code } from 'astro:components';

const tableApi = [
  { property: 'columns', description: 'Table column configuration', type: 'ColumnType<T>[]', default: '-' },
  { property: 'dataSource', description: 'Data to display in table', type: 'T[]', default: '-' },
  { property: 'rowKey', description: 'Unique key for each row', type: "keyof T | ((record: T) => string)", default: "'id'" },
  { property: 'loading', description: 'Loading state', type: 'boolean', default: 'false' },
  { property: 'size', description: 'Table size', type: "'xs' | 'sm' | 'md' | 'lg' | 'xl'", default: "'md'" },
  { property: 'bordered', description: 'Add border around table', type: 'boolean', default: 'false' },
  { property: 'hoverable', description: 'Highlight row on hover', type: 'boolean', default: 'true' },
  { property: 'striped', description: 'Alternating row colors (zebra stripes)', type: 'boolean', default: 'false' },
  { property: 'pinRows', description: 'Pin header rows while scrolling', type: 'boolean', default: 'false' },
  { property: 'pinCols', description: 'Pin columns while scrolling', type: 'boolean', default: 'false' },
  { property: 'pagination', description: 'Pagination configuration or false to disable', type: 'false | PaginationConfig', default: '{ pageSize: 10 }' },
  { property: 'rowSelection', description: 'Row selection configuration', type: 'RowSelection<T>', default: '-' },
  { property: 'expandable', description: 'Expandable row configuration', type: 'ExpandableConfig<T>', default: '-' },
  { property: 'scroll', description: 'Scroll configuration for fixed dimensions', type: 'ScrollConfig', default: '-' },
  { property: 'className', description: 'Additional CSS classes', type: 'string', default: '-' },
  { property: 'onRow', description: 'Row event handlers', type: '(record: T, index: number) => HTMLAttributes', default: '-' },
  { property: 'onChange', description: 'Unified callback for pagination, sorting, and filtering', type: '(pagination, filters, sorter, extra) => void', default: '-' },
  { property: 'onSortChange', description: 'Callback when sort changes', type: '(sorter: SorterResult<T>) => void', default: '-' },
  { property: 'onFilterChange', description: 'Callback when filter changes', type: '(filters: Record<string, ...>) => void', default: '-' },
  { property: 'locale', description: 'Localization config for empty text, filter labels', type: '{ emptyText?, filterConfirm?, filterReset?, selectAll? }', default: '-' },
  { property: 'data-testid', description: 'Test ID for the component', type: 'string', default: "'table'" },
  { property: 'aria-label', description: 'Accessible label for the table', type: 'string', default: '-' },
];

const columnTypeApi = [
  { property: 'key', description: 'Unique key for column', type: 'string', default: '-' },
  { property: 'title', description: 'Column header title', type: 'ReactNode', default: '-' },
  { property: 'dataIndex', description: 'Field name in data record', type: 'keyof T', default: '-' },
  { property: 'render', description: 'Custom render function for cell content', type: '(value, record, index) => ReactNode', default: '-' },
  { property: 'width', description: 'Column width', type: 'string | number', default: '-' },
  { property: 'align', description: 'Text alignment', type: "'left' | 'center' | 'right'", default: "'left'" },
  { property: 'fixed', description: 'Fix column to left or right', type: "'left' | 'right'", default: '-' },
  { property: 'sorter', description: 'Enable sorting or custom sort function', type: 'boolean | ((a: T, b: T) => number)', default: '-' },
  { property: 'sortOrder', description: 'Controlled sort order', type: "'ascend' | 'descend' | null", default: '-' },
  { property: 'defaultSortOrder', description: 'Default sort order', type: "'ascend' | 'descend'", default: '-' },
  { property: 'filters', description: 'Filter dropdown configuration', type: 'FilterConfig[]', default: '-' },
  { property: 'filteredValue', description: 'Controlled filtered values', type: '(string | number | boolean)[]', default: '-' },
  { property: 'defaultFilteredValue', description: 'Default filtered values', type: '(string | number | boolean)[]', default: '-' },
  { property: 'onFilter', description: 'Filter function', type: '(value, record) => boolean', default: '-' },
  { property: 'ellipsis', description: 'Truncate text with ellipsis', type: 'boolean', default: 'false' },
  { property: 'hidden', description: 'Hide column', type: 'boolean', default: 'false' },
];

const rowSelectionApi = [
  { property: 'type', description: 'Selection type', type: "'checkbox' | 'radio'", default: "'checkbox'" },
  { property: 'selectedRowKeys', description: 'Controlled selected row keys', type: 'React.Key[]', default: '-' },
  { property: 'onChange', description: 'Callback when selection changes', type: '(selectedRowKeys, selectedRows) => void', default: '-' },
  { property: 'getCheckboxProps', description: 'Function to customize checkbox props', type: '(record) => { disabled?, name? }', default: '-' },
];

const expandableApi = [
  { property: 'expandedRowRender', description: 'Render function for expanded content', type: '(record, index, expanded) => ReactNode', default: '-' },
  { property: 'expandedRowKeys', description: 'Controlled expanded row keys', type: 'React.Key[]', default: '-' },
  { property: 'defaultExpandedRowKeys', description: 'Default expanded row keys', type: 'React.Key[]', default: '-' },
  { property: 'rowExpandable', description: 'Function to determine if row is expandable', type: '(record) => boolean', default: '-' },
  { property: 'onExpand', description: 'Callback when expand state changes', type: '(expanded, record) => void', default: '-' },
  { property: 'onExpandedRowsChange', description: 'Callback when expanded keys change', type: '(expandedKeys) => void', default: '-' },
  { property: 'expandRowByClick', description: 'Expand row on row click', type: 'boolean', default: 'false' },
  { property: 'expandIcon', description: 'Custom expand icon', type: '(props) => ReactNode', default: '-' },
];

const paginationApi = [
  { property: 'current', description: 'Current page number', type: 'number', default: '1' },
  { property: 'pageSize', description: 'Number of items per page', type: 'number', default: '10' },
  { property: 'total', description: 'Total number of items (for server-side pagination)', type: 'number', default: '-' },
  { property: 'showSizeChanger', description: 'Show page size dropdown', type: 'boolean', default: 'false' },
  { property: 'showQuickJumper', description: 'Show quick page jumper input', type: 'boolean', default: 'false' },
  { property: 'showTotal', description: 'Function to render total text', type: '(total, range) => ReactNode', default: '-' },
  { property: 'pageSizeOptions', description: 'Page size options', type: 'number[]', default: '[10, 20, 50, 100]' },
  { property: 'position', description: 'Pagination position', type: "'topLeft' | 'topCenter' | 'topRight' | 'bottomLeft' | 'bottomCenter' | 'bottomRight'", default: "'bottomRight'" },
  { property: 'onChange', description: 'Callback when page changes', type: '(page, pageSize) => void', default: '-' },
  { property: 'onShowSizeChange', description: 'Callback when page size changes', type: '(current, size) => void', default: '-' },
];

const examples = [
  {
    id: 'basic',
    title: 'Basic Table',
    description: 'Simple table with data.',
  },
  {
    id: 'custom-render',
    title: 'Custom Rendering',
    description: 'Use render functions for tags, buttons, and custom content.',
  },
  {
    id: 'striped',
    title: 'Striped Rows',
    description: 'Zebra striping for better readability.',
  },
  {
    id: 'bordered',
    title: 'Bordered Table',
    description: 'Add borders for a more defined look.',
  },
  {
    id: 'size-xs',
    title: 'Compact Size',
    description: 'Extra small size for dense data.',
  },
  {
    id: 'size-xl',
    title: 'Extra Large Size',
    description: 'Extra large size for emphasis.',
  },
  {
    id: 'empty',
    title: 'Empty State',
    description: 'Customizable empty state message.',
  },
  {
    id: 'loading',
    title: 'Loading State',
    description: 'Show loading spinner while fetching data.',
  },
  {
    id: 'pagination',
    title: 'Basic Pagination',
    description: 'Paginate large datasets.',
  },
  {
    id: 'pagination-features',
    title: 'Advanced Pagination',
    description: 'Page size changer, quick jumper, and total display.',
  },
  {
    id: 'pinned',
    title: 'Pinned Header',
    description: 'Keep header visible while scrolling.',
  },
  {
    id: 'sorting',
    title: 'Column Sorting',
    description: 'Click column headers to sort data.',
  },
  {
    id: 'controlled-sort',
    title: 'Controlled Sorting',
    description: 'Externally control sort state.',
  },
  {
    id: 'filtering',
    title: 'Column Filtering',
    description: 'Add filter dropdowns to columns.',
  },
  {
    id: 'selection',
    title: 'Checkbox Selection',
    description: 'Enable row selection with checkboxes.',
  },
  {
    id: 'radio-selection',
    title: 'Radio Selection',
    description: 'Single row selection with radio buttons.',
  },
  {
    id: 'expandable',
    title: 'Expandable Rows',
    description: 'Expand rows to show additional content.',
  },
  {
    id: 'ellipsis',
    title: 'Text Ellipsis',
    description: 'Truncate long text with ellipsis.',
  },
  {
    id: 'scroll',
    title: 'Scroll Configuration',
    description: 'Set max width and height with scrolling.',
  },
  {
    id: 'complete',
    title: 'Complete Example',
    description: 'Table with multiple features combined.',
  },
];
---

<Layout title="Table - AsterUI">
  <div>
    <div class="mb-8">
      <nav class="text-sm breadcrumbs mb-4">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/components">Components</a></li>
          <li>Table</li>
        </ul>
      </nav>
      <h1 class="text-4xl font-bold mb-2">Table</h1>
      <p class="text-base-content/70 text-lg">Feature-rich table component for displaying tabular data.</p>
    </div>

    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Import</h2>
      <div class="border border-base-300 rounded-lg overflow-hidden [&_pre]:!m-0 [&_pre]:!rounded-none">
        <Code code={`import { Table } from 'asterui'
import type { ColumnType, RowSelection, ExpandableConfig, PaginationConfig } from 'asterui'`} lang="tsx" themes={{ light: 'github-light', dark: 'github-dark' }} defaultColor={false} />
      </div>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Examples</h2>
      <div class="columns-1 lg:columns-2 gap-6">
      {examples.map((example) => (
        <div class="example-card mb-6 border border-base-300 rounded-lg break-inside-avoid">
          <div class="p-4 bg-base-100 rounded-t-lg">
            <h3 class="text-lg font-semibold mb-1">{example.title}</h3>
            <p class="text-sm text-base-content/70 mb-4">{example.description}</p>
            <div class="demo-container overflow-x-auto" data-example={example.id}></div>
          </div>
        </div>
      ))}
      </div>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">API</h2>
      <ApiTable title="Table" data={tableApi} />
      <div class="mt-8">
        <ApiTable title="ColumnType" data={columnTypeApi} />
      </div>
      <div class="mt-8">
        <ApiTable title="RowSelection" data={rowSelectionApi} />
      </div>
      <div class="mt-8">
        <ApiTable title="ExpandableConfig" data={expandableApi} />
      </div>
      <div class="mt-8">
        <ApiTable title="PaginationConfig" data={paginationApi} />
      </div>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Accessibility</h2>
      <ul class="list-disc list-inside space-y-2 text-base-content/80">
        <li>Uses semantic <code class="bg-base-content/20 px-1 rounded">&lt;table&gt;</code> with <code class="bg-base-content/20 px-1 rounded">role="grid"</code></li>
        <li>Column headers include <code class="bg-base-content/20 px-1 rounded">role="columnheader"</code> and <code class="bg-base-content/20 px-1 rounded">aria-sort</code> for sortable columns</li>
        <li>Row selection checkboxes have proper <code class="bg-base-content/20 px-1 rounded">aria-label</code></li>
        <li>Sort controls are keyboard accessible (Enter/Space to toggle)</li>
        <li>Filter dropdowns support Escape key to close</li>
        <li>Pagination buttons include <code class="bg-base-content/20 px-1 rounded">aria-label</code> and <code class="bg-base-content/20 px-1 rounded">aria-current</code></li>
        <li>Expand/collapse buttons include <code class="bg-base-content/20 px-1 rounded">aria-expanded</code></li>
        <li>Indeterminate checkbox state for partial selection</li>
      </ul>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Testing</h2>
      <p class="text-base-content/80 mb-4">The component exposes <code class="bg-base-content/20 px-1 rounded">data-testid</code> attributes:</p>
      <ul class="list-disc list-inside space-y-1 text-base-content/80 text-sm">
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}'}</code> - Root wrapper</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-table'}</code> - Table element</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-header-{columnKey}'}</code> - Column headers</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}'}</code> - Table rows</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}-{columnKey}'}</code> - Table cells</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}-select'}</code> - Row selection checkbox</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}-expanded'}</code> - Expanded row content</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-select-all'}</code> - Select all checkbox</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-pagination'}</code> - Pagination container</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-prev'}</code>, <code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-next'}</code> - Pagination buttons</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-{columnKey}-filter-button'}</code> - Filter button</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-empty'}</code> - Empty state</li>
        <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-loading'}</code> - Loading state</li>
      </ul>
      <p class="text-base-content/80 mt-4">Data attributes:</p>
      <ul class="list-disc list-inside space-y-1 text-base-content/80 text-sm">
        <li><code class="bg-base-content/20 px-1 rounded">data-state="selected"</code> - On selected rows</li>
      </ul>
    </section>
  </div>
</Layout>

<style>
  .code-panel { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
  .example-card.open .code-panel { max-height: 2000px; }
</style>

<script>
  import '../../scripts/tableDemos.tsx';
</script>
