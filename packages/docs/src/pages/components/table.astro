---
import ComponentLayout from '../../layouts/ComponentLayout.astro';
import Example from '../../components/Example.astro';
import {
  BasicDemo,
  CustomRenderDemo,
  StripedDemo,
  BorderedDemo,
  SizeXsDemo,
  SizeXlDemo,
  EmptyDemo,
  LoadingDemo,
  PaginationDemo,
  PaginationFeaturesDemo,
  PinnedDemo,
  SortingDemo,
  ControlledSortDemo,
  FilteringDemo,
  SelectionDemo,
  RadioSelectionDemo,
  ExpandableDemo,
  EllipsisDemo,
  ScrollDemo,
  CompleteDemo,
} from '../../components/TableDemo';
import TableDemoSource from '../../components/TableDemo.tsx?raw';

const importCode = `import { Table } from 'asterui'
import type { ColumnType, RowSelection, ExpandableConfig, PaginationConfig } from 'asterui'`;

const api = [
  { property: 'columns', description: 'Table column configuration', type: 'ColumnType<T>[]', default: '-' },
  { property: 'dataSource', description: 'Data to display in table', type: 'T[]', default: '-' },
  { property: 'rowKey', description: 'Unique key for each row', type: "keyof T | ((record: T) => string)", default: "'id'" },
  { property: 'loading', description: 'Loading state', type: 'boolean', default: 'false' },
  { property: 'size', description: 'Table size', type: "'xs' | 'sm' | 'md' | 'lg' | 'xl'", default: "'md'" },
  { property: 'bordered', description: 'Add border around table', type: 'boolean', default: 'false' },
  { property: 'hoverable', description: 'Highlight row on hover', type: 'boolean', default: 'true' },
  { property: 'striped', description: 'Alternating row colors (zebra stripes)', type: 'boolean', default: 'false' },
  { property: 'pinRows', description: 'Pin header rows while scrolling', type: 'boolean', default: 'false' },
  { property: 'pinCols', description: 'Pin columns while scrolling', type: 'boolean', default: 'false' },
  { property: 'pagination', description: 'Pagination configuration or false to disable', type: 'false | PaginationConfig', default: '{ pageSize: 10 }' },
  { property: 'rowSelection', description: 'Row selection configuration', type: 'RowSelection<T>', default: '-' },
  { property: 'expandable', description: 'Expandable row configuration', type: 'ExpandableConfig<T>', default: '-' },
  { property: 'scroll', description: 'Scroll configuration for fixed dimensions', type: 'ScrollConfig', default: '-' },
  { property: 'className', description: 'Additional CSS classes', type: 'string', default: '-' },
  { property: 'onRow', description: 'Row event handlers', type: '(record: T, index: number) => HTMLAttributes', default: '-' },
  { property: 'onChange', description: 'Unified callback for pagination, sorting, and filtering', type: '(pagination, filters, sorter, extra) => void', default: '-' },
  { property: 'onSortChange', description: 'Callback when sort changes', type: '(sorter: SorterResult<T>) => void', default: '-' },
  { property: 'onFilterChange', description: 'Callback when filter changes', type: '(filters: Record<string, ...>) => void', default: '-' },
  { property: 'locale', description: 'Localization config for empty text, filter labels', type: '{ emptyText?, filterConfirm?, filterReset?, selectAll? }', default: '-' },
  { property: 'data-testid', description: 'Test ID for the component', type: 'string', default: "'table'" },
  { property: 'aria-label', description: 'Accessible label for the table', type: 'string', default: '-' },
];

const columnTypeApi = [
  { property: 'key', description: 'Unique key for column', type: 'string', default: '-' },
  { property: 'title', description: 'Column header title', type: 'ReactNode', default: '-' },
  { property: 'dataIndex', description: 'Field name in data record', type: 'keyof T', default: '-' },
  { property: 'render', description: 'Custom render function for cell content', type: '(value, record, index) => ReactNode', default: '-' },
  { property: 'width', description: 'Column width', type: 'string | number', default: '-' },
  { property: 'align', description: 'Text alignment', type: "'left' | 'center' | 'right'", default: "'left'" },
  { property: 'fixed', description: 'Fix column to left or right', type: "'left' | 'right'", default: '-' },
  { property: 'sorter', description: 'Enable sorting or custom sort function', type: 'boolean | ((a: T, b: T) => number)', default: '-' },
  { property: 'sortOrder', description: 'Controlled sort order', type: "'ascend' | 'descend' | null", default: '-' },
  { property: 'defaultSortOrder', description: 'Default sort order', type: "'ascend' | 'descend'", default: '-' },
  { property: 'filters', description: 'Filter dropdown configuration', type: 'FilterConfig[]', default: '-' },
  { property: 'filteredValue', description: 'Controlled filtered values', type: '(string | number | boolean)[]', default: '-' },
  { property: 'defaultFilteredValue', description: 'Default filtered values', type: '(string | number | boolean)[]', default: '-' },
  { property: 'onFilter', description: 'Filter function', type: '(value, record) => boolean', default: '-' },
  { property: 'ellipsis', description: 'Truncate text with ellipsis', type: 'boolean', default: 'false' },
  { property: 'hidden', description: 'Hide column', type: 'boolean', default: 'false' },
];

const rowSelectionApi = [
  { property: 'type', description: 'Selection type', type: "'checkbox' | 'radio'", default: "'checkbox'" },
  { property: 'selectedRowKeys', description: 'Controlled selected row keys', type: 'React.Key[]', default: '-' },
  { property: 'onChange', description: 'Callback when selection changes', type: '(selectedRowKeys, selectedRows) => void', default: '-' },
  { property: 'getCheckboxProps', description: 'Function to customize checkbox props', type: '(record) => { disabled?, name? }', default: '-' },
];

const expandableApi = [
  { property: 'expandedRowRender', description: 'Render function for expanded content', type: '(record, index, expanded) => ReactNode', default: '-' },
  { property: 'expandedRowKeys', description: 'Controlled expanded row keys', type: 'React.Key[]', default: '-' },
  { property: 'defaultExpandedRowKeys', description: 'Default expanded row keys', type: 'React.Key[]', default: '-' },
  { property: 'rowExpandable', description: 'Function to determine if row is expandable', type: '(record) => boolean', default: '-' },
  { property: 'onExpand', description: 'Callback when expand state changes', type: '(expanded, record) => void', default: '-' },
  { property: 'onExpandedRowsChange', description: 'Callback when expanded keys change', type: '(expandedKeys) => void', default: '-' },
  { property: 'expandRowByClick', description: 'Expand row on row click', type: 'boolean', default: 'false' },
  { property: 'expandIcon', description: 'Custom expand icon', type: '(props) => ReactNode', default: '-' },
];

const paginationApi = [
  { property: 'current', description: 'Current page number', type: 'number', default: '1' },
  { property: 'pageSize', description: 'Number of items per page', type: 'number', default: '10' },
  { property: 'total', description: 'Total number of items (for server-side pagination)', type: 'number', default: '-' },
  { property: 'showSizeChanger', description: 'Show page size dropdown', type: 'boolean', default: 'false' },
  { property: 'showQuickJumper', description: 'Show quick page jumper input', type: 'boolean', default: 'false' },
  { property: 'showTotal', description: 'Function to render total text', type: '(total, range) => ReactNode', default: '-' },
  { property: 'pageSizeOptions', description: 'Page size options', type: 'number[]', default: '[10, 20, 50, 100]' },
  { property: 'position', description: 'Pagination position', type: "'topLeft' | 'topCenter' | 'topRight' | 'bottomLeft' | 'bottomCenter' | 'bottomRight'", default: "'bottomRight'" },
  { property: 'onChange', description: 'Callback when page changes', type: '(page, pageSize) => void', default: '-' },
  { property: 'onShowSizeChange', description: 'Callback when page size changes', type: '(current, size) => void', default: '-' },
];
---

<ComponentLayout
  name="Table"
  description="Feature-rich table component for displaying tabular data."
  importCode={importCode}
  api={api}
>
  <Example title="Basic Table" description="Simple table with data." source={TableDemoSource} fn="BasicDemo">
    <BasicDemo client:load slot="demo" />
  </Example>

  <Example title="Custom Rendering" description="Use render functions for tags, buttons, and custom content." source={TableDemoSource} fn="CustomRenderDemo">
    <CustomRenderDemo client:load slot="demo" />
  </Example>

  <Example title="Striped Rows" description="Zebra striping for better readability." source={TableDemoSource} fn="StripedDemo">
    <StripedDemo client:load slot="demo" />
  </Example>

  <Example title="Bordered Table" description="Add borders for a more defined look." source={TableDemoSource} fn="BorderedDemo">
    <BorderedDemo client:load slot="demo" />
  </Example>

  <Example title="Compact Size" description="Extra small size for dense data." source={TableDemoSource} fn="SizeXsDemo">
    <SizeXsDemo client:load slot="demo" />
  </Example>

  <Example title="Extra Large Size" description="Extra large size for emphasis." source={TableDemoSource} fn="SizeXlDemo">
    <SizeXlDemo client:load slot="demo" />
  </Example>

  <Example title="Empty State" description="Customizable empty state message." source={TableDemoSource} fn="EmptyDemo">
    <EmptyDemo client:load slot="demo" />
  </Example>

  <Example title="Loading State" description="Show loading spinner while fetching data." source={TableDemoSource} fn="LoadingDemo">
    <LoadingDemo client:load slot="demo" />
  </Example>

  <Example title="Basic Pagination" description="Paginate large datasets." source={TableDemoSource} fn="PaginationDemo">
    <PaginationDemo client:load slot="demo" />
  </Example>

  <Example title="Advanced Pagination" description="Page size changer, quick jumper, and total display." source={TableDemoSource} fn="PaginationFeaturesDemo">
    <PaginationFeaturesDemo client:load slot="demo" />
  </Example>

  <Example title="Pinned Header" description="Keep header visible while scrolling." source={TableDemoSource} fn="PinnedDemo">
    <PinnedDemo client:load slot="demo" />
  </Example>

  <Example title="Column Sorting" description="Click column headers to sort data." source={TableDemoSource} fn="SortingDemo">
    <SortingDemo client:load slot="demo" />
  </Example>

  <Example title="Controlled Sorting" description="Externally control sort state." source={TableDemoSource} fn="ControlledSortDemo">
    <ControlledSortDemo client:load slot="demo" />
  </Example>

  <Example title="Column Filtering" description="Add filter dropdowns to columns." source={TableDemoSource} fn="FilteringDemo">
    <FilteringDemo client:load slot="demo" />
  </Example>

  <Example title="Checkbox Selection" description="Enable row selection with checkboxes." source={TableDemoSource} fn="SelectionDemo">
    <SelectionDemo client:load slot="demo" />
  </Example>

  <Example title="Radio Selection" description="Single row selection with radio buttons." source={TableDemoSource} fn="RadioSelectionDemo">
    <RadioSelectionDemo client:load slot="demo" />
  </Example>

  <Example title="Expandable Rows" description="Expand rows to show additional content." source={TableDemoSource} fn="ExpandableDemo">
    <ExpandableDemo client:load slot="demo" />
  </Example>

  <Example title="Text Ellipsis" description="Truncate long text with ellipsis." source={TableDemoSource} fn="EllipsisDemo">
    <EllipsisDemo client:load slot="demo" />
  </Example>

  <Example title="Scroll Configuration" description="Set max width and height with scrolling." source={TableDemoSource} fn="ScrollDemo">
    <ScrollDemo client:load slot="demo" />
  </Example>

  <Example title="Complete Example" description="Table with multiple features combined." source={TableDemoSource} fn="CompleteDemo">
    <CompleteDemo client:load slot="demo" />
  </Example>

  <section slot="accessibility" class="mb-8">
    <h2 class="text-2xl font-bold mb-4">Accessibility</h2>
    <ul class="list-disc list-inside space-y-2 text-base-content/80">
      <li>Uses semantic <code class="bg-base-content/20 px-1 rounded">&lt;table&gt;</code> with <code class="bg-base-content/20 px-1 rounded">role="grid"</code></li>
      <li>Column headers include <code class="bg-base-content/20 px-1 rounded">role="columnheader"</code> and <code class="bg-base-content/20 px-1 rounded">aria-sort</code> for sortable columns</li>
      <li>Row selection checkboxes have proper <code class="bg-base-content/20 px-1 rounded">aria-label</code></li>
      <li>Sort controls are keyboard accessible (Enter/Space to toggle)</li>
      <li>Filter dropdowns support Escape key to close</li>
      <li>Pagination buttons include <code class="bg-base-content/20 px-1 rounded">aria-label</code> and <code class="bg-base-content/20 px-1 rounded">aria-current</code></li>
      <li>Expand/collapse buttons include <code class="bg-base-content/20 px-1 rounded">aria-expanded</code></li>
      <li>Indeterminate checkbox state for partial selection</li>
    </ul>
  </section>

  <section slot="testing" class="mb-8">
    <h2 class="text-2xl font-bold mb-4">Testing</h2>
    <p class="text-base-content/80 mb-4">The component exposes <code class="bg-base-content/20 px-1 rounded">data-testid</code> attributes:</p>
    <ul class="list-disc list-inside space-y-1 text-base-content/80 text-sm">
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}'}</code> - Root wrapper</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-table'}</code> - Table element</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-header-{columnKey}'}</code> - Column headers</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}'}</code> - Table rows</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}-{columnKey}'}</code> - Table cells</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}-select'}</code> - Row selection checkbox</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-row-{index}-expanded'}</code> - Expanded row content</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-select-all'}</code> - Select all checkbox</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-pagination'}</code> - Pagination container</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-prev'}</code>, <code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-next'}</code> - Pagination buttons</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-{columnKey}-filter-button'}</code> - Filter button</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-empty'}</code> - Empty state</li>
      <li><code class="bg-base-content/20 px-1 rounded">{'{baseTestId}-loading'}</code> - Loading state</li>
    </ul>
    <p class="text-base-content/80 mt-4">Data attributes:</p>
    <ul class="list-disc list-inside space-y-1 text-base-content/80 text-sm">
      <li><code class="bg-base-content/20 px-1 rounded">data-state="selected"</code> - On selected rows</li>
    </ul>
  </section>

  <section slot="additional-api" class="mb-12">
    <div class="mt-8">
      <h3 class="text-xl font-semibold mb-4">ColumnType</h3>
      <div class="overflow-x-auto">
        <table class="table">
          <thead>
            <tr>
              <th>Property</th>
              <th>Description</th>
              <th>Type</th>
              <th>Default</th>
            </tr>
          </thead>
          <tbody>
            {columnTypeApi.map((row) => (
              <tr>
                <td><code>{row.property}</code></td>
                <td>{row.description}</td>
                <td><code>{row.type}</code></td>
                <td><code>{row.default}</code></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
    <div class="mt-8">
      <h3 class="text-xl font-semibold mb-4">RowSelection</h3>
      <div class="overflow-x-auto">
        <table class="table">
          <thead>
            <tr>
              <th>Property</th>
              <th>Description</th>
              <th>Type</th>
              <th>Default</th>
            </tr>
          </thead>
          <tbody>
            {rowSelectionApi.map((row) => (
              <tr>
                <td><code>{row.property}</code></td>
                <td>{row.description}</td>
                <td><code>{row.type}</code></td>
                <td><code>{row.default}</code></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
    <div class="mt-8">
      <h3 class="text-xl font-semibold mb-4">ExpandableConfig</h3>
      <div class="overflow-x-auto">
        <table class="table">
          <thead>
            <tr>
              <th>Property</th>
              <th>Description</th>
              <th>Type</th>
              <th>Default</th>
            </tr>
          </thead>
          <tbody>
            {expandableApi.map((row) => (
              <tr>
                <td><code>{row.property}</code></td>
                <td>{row.description}</td>
                <td><code>{row.type}</code></td>
                <td><code>{row.default}</code></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
    <div class="mt-8">
      <h3 class="text-xl font-semibold mb-4">PaginationConfig</h3>
      <div class="overflow-x-auto">
        <table class="table">
          <thead>
            <tr>
              <th>Property</th>
              <th>Description</th>
              <th>Type</th>
              <th>Default</th>
            </tr>
          </thead>
          <tbody>
            {paginationApi.map((row) => (
              <tr>
                <td><code>{row.property}</code></td>
                <td>{row.description}</td>
                <td><code>{row.type}</code></td>
                <td><code>{row.default}</code></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>
</ComponentLayout>
