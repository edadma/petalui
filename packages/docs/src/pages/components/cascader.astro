---
import ComponentLayout from '../../layouts/ComponentLayout.astro';
import Example from '../../components/Example.astro';
import {
  BasicDemo,
  HoverDemo,
  SizesDemo,
  DisabledDemo,
  SearchDemo,
  ChangeOnSelectDemo,
  AsyncLoadDemo,
  StatusDemo,
  MultipleDemo,
} from '../../components/CascaderDemo';
import CascaderDemoSource from '../../components/CascaderDemo.tsx?raw';

const api = [
  { title: 'Cascader', data: [
    { property: 'options', description: 'Hierarchical options data', type: 'CascaderOption[]', default: '[]' },
    { property: 'value', description: 'Controlled selected value path', type: 'string[]' },
    { property: 'defaultValue', description: 'Default selected value (uncontrolled)', type: 'string[]', default: '[]' },
    { property: 'onChange', description: 'Callback when selection changes', type: '(value: string[], selectedOptions: CascaderOption[]) => void' },
    { property: 'placeholder', description: 'Input placeholder text', type: 'string', default: "'Please select'" },
    { property: 'disabled', description: 'Disable the cascader', type: 'boolean', default: 'false' },
    { property: 'allowClear', description: 'Show clear button', type: 'boolean', default: 'true' },
    { property: 'expandTrigger', description: 'How to expand sub-menus', type: "'click' | 'hover'", default: "'click'" },
    { property: 'changeOnSelect', description: 'Allow selection of any level, not just leaves', type: 'boolean', default: 'false' },
    { property: 'displayRender', description: 'Custom display render function', type: '(labels: ReactNode[], selectedOptions: CascaderOption[]) => ReactNode' },
    { property: 'size', description: 'Input size', type: "'xs' | 'sm' | 'md' | 'lg'", default: "'md'" },
    { property: 'color', description: 'Focus ring color', type: "'primary' | 'secondary' | 'accent' | 'info' | 'success' | 'warning' | 'error'" },
    { property: 'status', description: 'Validation status', type: "'error' | 'warning'" },
    { property: 'showSearch', description: 'Enable search functionality', type: 'boolean | { filter?, render?, matchInputWidth? }', default: 'false' },
    { property: 'notFoundContent', description: 'Content when no search results', type: 'ReactNode', default: "'No results found'" },
    { property: 'loadData', description: 'Async data loading function', type: '(selectedOptions: CascaderOption[]) => Promise<void>' },
    { property: 'fieldNames', description: 'Custom field names for data mapping', type: '{ label?: string; value?: string; children?: string }' },
    { property: 'open', description: 'Controlled dropdown open state', type: 'boolean' },
    { property: 'onDropdownVisibleChange', description: 'Callback when dropdown visibility changes', type: '(open: boolean) => void' },
    { property: 'popupClassName', description: 'Class name for dropdown', type: 'string' },
    { property: 'dropdownRender', description: 'Custom dropdown wrapper render', type: '(menu: ReactNode) => ReactNode' },
    { property: 'multiple', description: 'Enable multiple selection mode', type: 'boolean', default: 'false' },
    { property: 'maxTagCount', description: 'Max tags to show in multiple mode', type: "number | 'responsive'" },
    { property: 'className', description: 'Additional CSS classes', type: 'string' },
  ]},
  { title: 'CascaderOption', data: [
    { property: 'value', description: 'Unique identifier', type: 'string' },
    { property: 'label', description: 'Display label', type: 'ReactNode' },
    { property: 'children', description: 'Child options', type: 'CascaderOption[]' },
    { property: 'disabled', description: 'Disable this option', type: 'boolean', default: 'false' },
    { property: 'isLeaf', description: 'Force as leaf node (no expand, no async load)', type: 'boolean' },
  ]},
];
---

<ComponentLayout
  name="Cascader"
  description="Cascade selection box for hierarchical data like locations or categories."
  api={api}
>
  <Example title="Basic" description="Simple hierarchical selection." source={CascaderDemoSource} fn="BasicDemo">
    <BasicDemo client:load slot="demo" />
  </Example>

  <Example title="Hover Expand" description="Expand sub-menus on hover." source={CascaderDemoSource} fn="HoverDemo">
    <HoverDemo client:load slot="demo" />
  </Example>

  <Example title="Sizes" description="Different cascader sizes." source={CascaderDemoSource} fn="SizesDemo">
    <SizesDemo client:load slot="demo" />
  </Example>

  <Example title="Disabled" description="Disabled cascader state." source={CascaderDemoSource} fn="DisabledDemo">
    <DisabledDemo client:load slot="demo" />
  </Example>

  <Example title="Search" description="Enable search/filter functionality." source={CascaderDemoSource} fn="SearchDemo">
    <SearchDemo client:load slot="demo" />
  </Example>

  <Example title="Change On Select" description="Allow selection of any level, not just leaf nodes." source={CascaderDemoSource} fn="ChangeOnSelectDemo">
    <ChangeOnSelectDemo client:load slot="demo" />
  </Example>

  <Example title="Async Loading" description="Load options dynamically when expanding." source={CascaderDemoSource} fn="AsyncLoadDemo">
    <AsyncLoadDemo client:load slot="demo" />
  </Example>

  <Example title="Validation Status" description="Show error or warning validation state." source={CascaderDemoSource} fn="StatusDemo">
    <StatusDemo client:load slot="demo" />
  </Example>

  <Example title="Multiple Selection" description="Select multiple leaf values." source={CascaderDemoSource} fn="MultipleDemo">
    <MultipleDemo client:load slot="demo" />
  </Example>

  <section slot="accessibility" class="mb-8">
    <h2 class="text-2xl font-bold mb-4">Accessibility</h2>
    <p class="mb-4">The Cascader component follows WAI-ARIA combobox pattern:</p>
    <ul class="list-disc list-inside space-y-2 text-base-content/80 mb-6">
      <li>Uses <code class="bg-base-content/20 px-1 rounded">role="combobox"</code> on trigger with <code class="bg-base-content/20 px-1 rounded">aria-expanded</code>, <code class="bg-base-content/20 px-1 rounded">aria-haspopup</code></li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-activedescendant</code> tracks focused option for screen readers</li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-selected</code> indicates selected state on options</li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-disabled</code> indicates disabled state</li>
      <li>Clear button has <code class="bg-base-content/20 px-1 rounded">aria-label="Clear selection"</code></li>
    </ul>

    <h3 class="text-xl font-semibold mb-4">Keyboard Navigation</h3>
    <div class="overflow-x-auto">
      <table class="table">
        <thead>
          <tr>
            <th>Key</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><kbd class="kbd kbd-sm">↓</kbd></td><td>Open dropdown or move to next option</td></tr>
          <tr><td><kbd class="kbd kbd-sm">↑</kbd></td><td>Move to previous option</td></tr>
          <tr><td><kbd class="kbd kbd-sm">→</kbd></td><td>Move to next column (expand)</td></tr>
          <tr><td><kbd class="kbd kbd-sm">←</kbd></td><td>Move to previous column</td></tr>
          <tr><td><kbd class="kbd kbd-sm">Enter</kbd></td><td>Select focused option or open dropdown</td></tr>
          <tr><td><kbd class="kbd kbd-sm">Space</kbd></td><td>Toggle dropdown (when not searching)</td></tr>
          <tr><td><kbd class="kbd kbd-sm">Escape</kbd></td><td>Close dropdown</td></tr>
          <tr><td><kbd class="kbd kbd-sm">Home</kbd></td><td>Move to first option</td></tr>
          <tr><td><kbd class="kbd kbd-sm">End</kbd></td><td>Move to last option</td></tr>
        </tbody>
      </table>
    </div>

    <h3 class="text-xl font-semibold mt-6 mb-4">Testing</h3>
    <p class="mb-2">The component includes data attributes for testing:</p>
    <ul class="list-disc list-inside space-y-2 text-base-content/80">
      <li><code class="bg-base-content/20 px-1 rounded">data-testid="cascader"</code> on the root container</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-testid="cascader-dropdown"</code> on the dropdown</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-testid="cascader-option-{'{'}value{'}'}"</code> on each option</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-testid="cascader-clear"</code> on the clear button</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-state="open|closed"</code> on root indicates dropdown state</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-state="selected|hovered"</code> on options indicates state</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-value="{'{'}value{'}'}"</code> on options provides the value</li>
    </ul>
  </section>
</ComponentLayout>
