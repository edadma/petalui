---
import ComponentLayout from '../../layouts/ComponentLayout.astro';
import Example from '../../components/Example.astro';
import {
  BasicDemo,
  CheckableDemo,
  SelectableDemo,
  MultipleDemo,
  ShowLineDemo,
  ShowIconDemo,
  CompoundDemo,
  CheckboxColorsDemo,
  CheckStrictlyDemo,
  AsyncLoadDemo,
} from '../../components/TreeDemo';
import TreeDemoSource from '../../components/TreeDemo.tsx?raw';

const api = [
  { title: 'Tree', data: [
    { property: 'treeData', description: 'Tree data structure (alternative to compound pattern)', type: 'TreeDataNode[]', default: '[]' },
    { property: 'children', description: 'Tree.Node children for compound pattern', type: 'React.ReactNode', default: '-' },
    { property: 'checkable', description: 'Show checkbox for each node', type: 'boolean', default: 'false' },
    { property: 'checkboxColor', description: 'Checkbox color (DaisyUI)', type: "'primary' | 'secondary' | 'accent' | 'neutral' | 'info' | 'success' | 'warning' | 'error'", default: "'primary'" },
    { property: 'checkboxSize', description: 'Checkbox size (DaisyUI)', type: "'xs' | 'sm' | 'md' | 'lg' | 'xl'", default: "'sm'" },
    { property: 'checkedKeys', description: 'Controlled checked keys', type: 'string[]', default: '-' },
    { property: 'defaultCheckedKeys', description: 'Default checked keys', type: 'string[]', default: '[]' },
    { property: 'checkStrictly', description: 'Decouple parent-child checkbox relationship', type: 'boolean', default: 'false' },
    { property: 'onCheck', description: 'Callback when node is checked', type: '(keys: string[], info: { node, checked }) => void', default: '-' },
    { property: 'selectable', description: 'Enable node selection', type: 'boolean', default: 'true' },
    { property: 'selectedKeys', description: 'Controlled selected keys', type: 'string[]', default: '-' },
    { property: 'defaultSelectedKeys', description: 'Default selected keys', type: 'string[]', default: '[]' },
    { property: 'onSelect', description: 'Callback when node is selected', type: '(keys: string[], info: { node, selected }) => void', default: '-' },
    { property: 'multiple', description: 'Allow multiple selection', type: 'boolean', default: 'false' },
    { property: 'expandedKeys', description: 'Controlled expanded keys', type: 'string[]', default: '-' },
    { property: 'defaultExpandedKeys', description: 'Default expanded keys', type: 'string[]', default: '[]' },
    { property: 'defaultExpandAll', description: 'Expand all nodes by default', type: 'boolean', default: 'false' },
    { property: 'autoExpandParent', description: 'Auto expand parent nodes', type: 'boolean', default: 'true' },
    { property: 'onExpand', description: 'Callback when node is expanded', type: '(keys: string[], info: { node, expanded }) => void', default: '-' },
    { property: 'showLine', description: 'Show connecting lines', type: 'boolean', default: 'false' },
    { property: 'showIcon', description: 'Show node icons', type: 'boolean', default: 'false' },
    { property: 'blockNode', description: 'Make nodes fill horizontal space', type: 'boolean', default: 'false' },
    { property: 'switcherIcon', description: 'Custom expand/collapse icon', type: 'ReactNode | ((expanded: boolean) => ReactNode)', default: '-' },
    { property: 'titleRender', description: 'Custom title render function', type: '(node: TreeDataNode) => ReactNode', default: '-' },
    { property: 'filterTreeNode', description: 'Filter function to highlight nodes', type: '(node: TreeDataNode) => boolean', default: '-' },
    { property: 'loadData', description: 'Async data loading function', type: '(node: TreeDataNode) => Promise<void>', default: '-' },
    { property: 'onRightClick', description: 'Right click handler', type: '(info: { event, node }) => void', default: '-' },
    { property: 'fieldNames', description: 'Custom field names for data mapping', type: '{ key?: string; title?: string; children?: string }', default: '-' },
    { property: 'className', description: 'Additional CSS classes', type: 'string', default: '-' },
  ]},
  { title: 'TreeDataNode (for treeData prop)', data: [
    { property: 'key', description: 'Unique identifier', type: 'string', default: '-' },
    { property: 'title', description: 'Display title', type: 'React.ReactNode', default: '-' },
    { property: 'children', description: 'Child nodes', type: 'TreeDataNode[]', default: '-' },
    { property: 'icon', description: 'Custom icon', type: 'React.ReactNode', default: '-' },
    { property: 'disabled', description: 'Disable the node', type: 'boolean', default: 'false' },
    { property: 'disableCheckbox', description: 'Disable checkbox for the node', type: 'boolean', default: 'false' },
    { property: 'selectable', description: 'Whether node can be selected', type: 'boolean', default: 'true' },
    { property: 'checkable', description: 'Whether node shows checkbox', type: 'boolean', default: 'true' },
    { property: 'isLeaf', description: 'Force node to be a leaf (no expand icon)', type: 'boolean', default: '-' },
  ]},
  { title: 'Tree.Node (compound pattern)', data: [
    { property: 'key', description: 'Unique identifier (React key prop)', type: 'string', default: '-' },
    { property: 'title', description: 'Display title', type: 'React.ReactNode', default: '-' },
    { property: 'children', description: 'Child Tree.Node elements', type: 'React.ReactNode', default: '-' },
    { property: 'icon', description: 'Custom icon', type: 'React.ReactNode', default: '-' },
    { property: 'disabled', description: 'Disable the node', type: 'boolean', default: 'false' },
    { property: 'disableCheckbox', description: 'Disable checkbox for the node', type: 'boolean', default: 'false' },
    { property: 'selectable', description: 'Whether node can be selected', type: 'boolean', default: 'true' },
    { property: 'checkable', description: 'Whether node shows checkbox', type: 'boolean', default: 'true' },
    { property: 'isLeaf', description: 'Force node to be a leaf (no expand icon)', type: 'boolean', default: '-' },
  ]},
];
---

<ComponentLayout
  name="Tree"
  description="Hierarchical tree structure for displaying nested data."
  api={api}
>
  <Example title="Basic Tree" description="Simple tree with expandable nodes." source={TreeDemoSource} fn="BasicDemo">
    <BasicDemo client:load slot="demo" />
  </Example>

  <Example title="Checkable" description="Tree with checkbox selection." source={TreeDemoSource} fn="CheckableDemo">
    <CheckableDemo client:load slot="demo" />
  </Example>

  <Example title="Selectable" description="Tree with node selection." source={TreeDemoSource} fn="SelectableDemo">
    <SelectableDemo client:load slot="demo" />
  </Example>

  <Example title="Multiple Selection" description="Allow selecting multiple nodes." source={TreeDemoSource} fn="MultipleDemo">
    <MultipleDemo client:load slot="demo" />
  </Example>

  <Example title="Show Line" description="Display connecting lines between nodes." source={TreeDemoSource} fn="ShowLineDemo">
    <ShowLineDemo client:load slot="demo" />
  </Example>

  <Example title="Show Icon" description="Display custom icons for nodes." source={TreeDemoSource} fn="ShowIconDemo">
    <ShowIconDemo client:load slot="demo" />
  </Example>

  <Example title="Compound Pattern" description="Use Tree.Node for declarative tree structure." source={TreeDemoSource} fn="CompoundDemo">
    <CompoundDemo client:load slot="demo" />
  </Example>

  <Example title="Checkbox Colors" description="Customize checkbox appearance with DaisyUI colors." source={TreeDemoSource} fn="CheckboxColorsDemo">
    <CheckboxColorsDemo client:load slot="demo" />
  </Example>

  <Example title="Check Strictly" description="Decouple parent-child checkbox relationship." source={TreeDemoSource} fn="CheckStrictlyDemo">
    <CheckStrictlyDemo client:load slot="demo" />
  </Example>

  <Example title="Async Loading" description="Load child nodes asynchronously on expand." source={TreeDemoSource} fn="AsyncLoadDemo">
    <AsyncLoadDemo client:load slot="demo" />
  </Example>

  <section slot="accessibility" class="mb-8">
    <h2 class="text-2xl font-bold mb-4">Accessibility</h2>
    <p class="text-base-content/80 mb-4">The Tree component implements the full WAI-ARIA tree pattern:</p>
    <ul class="list-disc list-inside space-y-2 text-base-content/80 mb-6">
      <li><code class="bg-base-content/20 px-1 rounded">role="tree"</code> on container and <code class="bg-base-content/20 px-1 rounded">role="treeitem"</code> on nodes</li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-expanded</code> indicates node expansion state</li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-selected</code> indicates selection state</li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-checked</code> indicates checkbox state (with <code class="bg-base-content/20 px-1 rounded">"mixed"</code> for indeterminate)</li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-disabled</code> indicates disabled state</li>
      <li><code class="bg-base-content/20 px-1 rounded">aria-level</code> indicates nesting depth</li>
    </ul>
    <h3 class="text-lg font-semibold mb-3">Keyboard Navigation</h3>
    <div class="overflow-x-auto">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Key</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><kbd class="kbd kbd-sm">↓</kbd></td><td>Move focus to next visible node</td></tr>
          <tr><td><kbd class="kbd kbd-sm">↑</kbd></td><td>Move focus to previous visible node</td></tr>
          <tr><td><kbd class="kbd kbd-sm">→</kbd></td><td>Expand collapsed node, or move to first child</td></tr>
          <tr><td><kbd class="kbd kbd-sm">←</kbd></td><td>Collapse expanded node</td></tr>
          <tr><td><kbd class="kbd kbd-sm">Enter</kbd> / <kbd class="kbd kbd-sm">Space</kbd></td><td>Toggle checkbox, select node, or expand/collapse</td></tr>
          <tr><td><kbd class="kbd kbd-sm">Home</kbd></td><td>Move focus to first node</td></tr>
          <tr><td><kbd class="kbd kbd-sm">End</kbd></td><td>Move focus to last visible node</td></tr>
        </tbody>
      </table>
    </div>
    <h3 class="text-lg font-semibold mb-3 mt-6">Testing</h3>
    <p class="text-base-content/80 mb-3">The component includes data attributes for testing:</p>
    <ul class="list-disc list-inside space-y-2 text-base-content/80">
      <li><code class="bg-base-content/20 px-1 rounded">data-testid="tree"</code> on the tree container</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-testid="tree-node-&#123;key&#125;"</code> on each node</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-state="selected|expanded|collapsed"</code> indicates node state</li>
      <li><code class="bg-base-content/20 px-1 rounded">data-key="&#123;key&#125;"</code> provides the node key</li>
    </ul>
  </section>
</ComponentLayout>
