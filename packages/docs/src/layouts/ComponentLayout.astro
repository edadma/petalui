---
import Layout from './Layout.astro';
import ApiTable from '../components/ApiTable.astro';
import { Code } from 'astro:components';

interface ApiItem {
  property: string;
  description: string;
  type: string;
  default?: string;
}

interface Props {
  name: string;
  description: string;
  importCode?: string;
  api?: ApiItem[] | Array<{ title: string; data: ApiItem[] }>;
  singleColumn?: boolean;
}

const { name, description, importCode, api, singleColumn = false } = Astro.props;
const defaultImport = `import { ${name} } from 'asterui'`;

// Normalize api to always be an array of { title, data }
const apiTables = api
  ? Array.isArray(api) && api.length > 0 && 'property' in api[0]
    ? [{ title: name, data: api as ApiItem[] }]
    : (api as Array<{ title: string; data: ApiItem[] }>)
  : [];
---

<Layout title={`${name} - AsterUI`}>
  <div>
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-2">{name}</h1>
      <p class="text-base-content/70 text-lg">{description}</p>
    </div>

    <!-- Installation (optional slot) -->
    <slot name="installation" />

    <!-- Import -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Import</h2>
      <div class="border border-base-300 rounded-lg overflow-hidden [&_pre]:!m-0 [&_pre]:!rounded-none">
        <Code code={importCode || defaultImport} lang="tsx" themes={{ light: 'github-light', dark: 'github-dark' }} defaultColor={false} />
      </div>
    </section>

    <!-- Examples -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Examples</h2>
      <div class={singleColumn ? "space-y-6" : "columns-1 lg:columns-2 gap-6"}>
        <slot />
      </div>
    </section>

    <!-- API -->
    {apiTables.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">API</h2>
        <slot name="api-notes" />
        <div class="space-y-8">
          {apiTables.map((table) => (
            <ApiTable title={table.title} data={table.data} />
          ))}
        </div>
      </section>
    )}

    <!-- Additional API (optional slot) -->
    <slot name="additional-api" />

    <!-- Accessibility (optional slot) -->
    <slot name="accessibility" />

    <!-- Testing (optional slot) -->
    <slot name="testing" />

    <!-- Usage Tips (optional slot) -->
    <slot name="usage-tips" />
  </div>
</Layout>
