---
import '../styles/global.css';
import fs from 'node:fs';
import path from 'node:path';
import { siNpm, siGithub } from 'simple-icons';

const pkgPath = path.join(process.cwd(), 'node_modules/asterui/package.json');
const { version } = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'AsterUI - Free open source React component library built on DaisyUI v5 and Tailwind CSS v4' } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, 'https://asterui.com');
const ogImage = 'https://asterui.com/logo.png';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <meta name="keywords" content="AsterUI, Aster UI, React components, DaisyUI, DaisyUI v5, DaisyUI React, React DaisyUI, DaisyUI component library, React components for DaisyUI, Tailwind CSS v4, Tailwind React, TypeScript UI library, open source component library, React form validation, React modal, React table" />

    <link rel="canonical" href={canonicalURL} />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="AsterUI" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={ogImage} />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="256x256" href="/logo.png" />
    <title>{title}</title>
    <style>
      .search-input {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        min-width: 14rem;
        background: oklch(var(--b3));
        border: 1px solid oklch(var(--bc) / 0.15);
        border-radius: 0.5rem;
        cursor: pointer;
        transition: border-color 0.15s, box-shadow 0.15s;
      }

      .search-input:hover {
        border-color: oklch(var(--bc) / 0.3);
      }

      .search-input:focus {
        outline: none;
        border-color: oklch(var(--p));
        box-shadow: 0 0 0 2px oklch(var(--p) / 0.2);
      }

      .search-icon {
        width: 1rem;
        height: 1rem;
        color: oklch(var(--bc) / 0.5);
      }

      .search-placeholder {
        flex: 1;
        text-align: left;
        font-size: 0.875rem;
        color: oklch(var(--bc) / 0.5);
      }

      .search-kbd {
        padding: 0.125rem 0.375rem;
        font-size: 0.75rem;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        background: oklch(var(--b2));
        border: 1px solid oklch(var(--bc) / 0.15);
        border-radius: 0.25rem;
        color: oklch(var(--bc) / 0.6);
      }
    </style>
  </head>
  <body class="min-h-screen bg-base-100 text-base-content">
    <!-- Header -->
    <header class="sticky top-0 z-50 navbar bg-base-200/95 backdrop-blur border-b border-base-300 px-4">
      <div class="navbar-start gap-2">
        <a href="/" class="btn btn-ghost text-xl gap-2">
          <img src="/logo.png" alt="AsterUI" class="h-8 w-8" />
          <span class="font-semibold">AsterUI</span>
        </a>
        <span class="badge badge-ghost text-xs">v{version}</span>
      </div>

      <div class="navbar-center hidden lg:flex">
        <!-- Search input style -->
        <button class="search-input" id="search-button">
          <svg xmlns="http://www.w3.org/2000/svg" class="search-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <span class="search-placeholder">Search</span>
          <kbd class="search-kbd" id="search-kbd">Ctrl K</kbd>
        </button>
      </div>

      <div class="navbar-end">
        <nav class="flex gap-1 items-center">
          <a href="https://github.com/edadma/asterui" class="btn btn-ghost btn-sm btn-square" aria-label="GitHub">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
              <path d={siGithub.path}/>
            </svg>
          </a>
          <a href="https://www.npmjs.com/package/asterui" class="btn btn-ghost btn-sm btn-square" aria-label="npm">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
              <path d={siNpm.path}/>
            </svg>
          </a>
          <div class="divider divider-horizontal mx-1 h-6 self-center"></div>
          <label class="swap swap-rotate btn btn-ghost btn-sm btn-square">
            <input type="checkbox" id="theme-toggle" value="light" />
            <svg class="swap-off h-5 w-5 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
            </svg>
            <svg class="swap-on h-5 w-5 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
            </svg>
          </label>
        </nav>
      </div>
    </header>

    <!-- Main content - full width, no sidebar -->
    <main class="min-h-[calc(100vh-4rem)]">
      <slot />
    </main>

    <!-- Search Modal -->
    <dialog id="search-modal" class="modal">
      <div class="modal-box max-w-2xl">
        <div class="flex items-center gap-3 border-b border-base-300 pb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input
            type="text"
            id="search-input"
            placeholder="Search components, props, examples..."
            class="input input-ghost flex-1 focus:outline-none text-lg"
            autocomplete="off"
          />
          <kbd class="kbd kbd-sm">ESC</kbd>
        </div>
        <div id="search-results" class="mt-4 max-h-96 overflow-y-auto">
          <p class="text-base-content/50 text-center py-8">Type to search...</p>
        </div>
      </div>
      <form method="dialog" class="modal-backdrop">
        <button>close</button>
      </form>
    </dialog>

    <script>
      // Update keyboard shortcut for Mac
      const searchKbd = document.getElementById('search-kbd');
      if (searchKbd && navigator.platform.toUpperCase().indexOf('MAC') >= 0) {
        searchKbd.textContent = 'âŒ˜K';
      }

      // Theme toggle
      const themeToggle = document.getElementById('theme-toggle') as HTMLInputElement;

      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
        themeToggle.checked = savedTheme === 'light';
      }

      themeToggle?.addEventListener('change', (e) => {
        const target = e.target as HTMLInputElement;
        const newTheme = target.checked ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });

      // Search modal
      const searchButton = document.getElementById('search-button');
      const searchModal = document.getElementById('search-modal') as HTMLDialogElement;
      const searchInput = document.getElementById('search-input') as HTMLInputElement;
      const searchResults = document.getElementById('search-results');

      // Component index for search
      const components = [
        { name: 'Button', href: '/components/button', category: 'Actions' },
        { name: 'CopyButton', href: '/components/copybutton', category: 'Actions' },
        { name: 'FloatButton', href: '/components/floatbutton', category: 'Actions' },
        { name: 'Avatar', href: '/components/avatar', category: 'Data Display' },
        { name: 'Badge', href: '/components/badge', category: 'Data Display' },
        { name: 'Card', href: '/components/card', category: 'Data Display' },
        { name: 'Carousel', href: '/components/carousel', category: 'Data Display' },
        { name: 'Collapse', href: '/components/collapse', category: 'Data Display' },
        { name: 'Descriptions', href: '/components/descriptions', category: 'Data Display' },
        { name: 'Empty', href: '/components/empty', category: 'Data Display' },
        { name: 'Image', href: '/components/image', category: 'Data Display' },
        { name: 'List', href: '/components/list', category: 'Data Display' },
        { name: 'Stat', href: '/components/stat', category: 'Data Display' },
        { name: 'Table', href: '/components/table', category: 'Data Display' },
        { name: 'Tag', href: '/components/tag', category: 'Data Display' },
        { name: 'Timeline', href: '/components/timeline', category: 'Data Display' },
        { name: 'Tooltip', href: '/components/tooltip', category: 'Data Display' },
        { name: 'Tree', href: '/components/tree', category: 'Data Display' },
        { name: 'Autocomplete', href: '/components/autocomplete', category: 'Data Entry' },
        { name: 'Cascader', href: '/components/cascader', category: 'Data Entry' },
        { name: 'Checkbox', href: '/components/checkbox', category: 'Data Entry' },
        { name: 'ColorPicker', href: '/components/colorpicker', category: 'Data Entry' },
        { name: 'DatePicker', href: '/components/datepicker', category: 'Data Entry' },
        { name: 'FileInput', href: '/components/fileinput', category: 'Data Entry' },
        { name: 'Form', href: '/components/form', category: 'Data Entry' },
        { name: 'Input', href: '/components/input', category: 'Data Entry' },
        { name: 'InputNumber', href: '/components/inputnumber', category: 'Data Entry' },
        { name: 'Mention', href: '/components/mention', category: 'Data Entry' },
        { name: 'OTPInput', href: '/components/otpinput', category: 'Data Entry' },
        { name: 'Radio', href: '/components/radio', category: 'Data Entry' },
        { name: 'Range', href: '/components/range', category: 'Data Entry' },
        { name: 'Rating', href: '/components/rating', category: 'Data Entry' },
        { name: 'Select', href: '/components/select', category: 'Data Entry' },
        { name: 'Textarea', href: '/components/textarea', category: 'Data Entry' },
        { name: 'TimePicker', href: '/components/timepicker', category: 'Data Entry' },
        { name: 'Toggle', href: '/components/toggle', category: 'Data Entry' },
        { name: 'Transfer', href: '/components/transfer', category: 'Data Entry' },
        { name: 'TreeSelect', href: '/components/treeselect', category: 'Data Entry' },
        { name: 'Upload', href: '/components/upload', category: 'Data Entry' },
        { name: 'Alert', href: '/components/alert', category: 'Feedback' },
        { name: 'Drawer', href: '/components/drawer', category: 'Feedback' },
        { name: 'Loading', href: '/components/loading', category: 'Feedback' },
        { name: 'Modal', href: '/components/modal', category: 'Feedback' },
        { name: 'Notification', href: '/components/notification', category: 'Feedback' },
        { name: 'Popconfirm', href: '/components/popconfirm', category: 'Feedback' },
        { name: 'Progress', href: '/components/progress', category: 'Feedback' },
        { name: 'Result', href: '/components/result', category: 'Feedback' },
        { name: 'Skeleton', href: '/components/skeleton', category: 'Feedback' },
        { name: 'Anchor', href: '/components/anchor', category: 'Navigation' },
        { name: 'Breadcrumb', href: '/components/breadcrumb', category: 'Navigation' },
        { name: 'Dropdown', href: '/components/dropdown', category: 'Navigation' },
        { name: 'Menu', href: '/components/menu', category: 'Navigation' },
        { name: 'Navbar', href: '/components/navbar', category: 'Navigation' },
        { name: 'Pagination', href: '/components/pagination', category: 'Navigation' },
        { name: 'Steps', href: '/components/steps', category: 'Navigation' },
        { name: 'Tabs', href: '/components/tabs', category: 'Navigation' },
        { name: 'Container', href: '/components/container', category: 'Layout' },
        { name: 'Divider', href: '/components/divider', category: 'Layout' },
        { name: 'Flex', href: '/components/flex', category: 'Layout' },
        { name: 'Grid', href: '/components/grid', category: 'Layout' },
        { name: 'Space', href: '/components/space', category: 'Layout' },
        { name: 'Splitter', href: '/components/splitter', category: 'Layout' },
        { name: 'Affix', href: '/components/affix', category: 'Other' },
        { name: 'Chart', href: '/components/chart', category: 'Other' },
        { name: 'Code', href: '/components/code', category: 'Other' },
        { name: 'QRCode', href: '/components/qrcode', category: 'Other' },
        { name: 'Tour', href: '/components/tour', category: 'Other' },
        { name: 'Watermark', href: '/components/watermark', category: 'Other' },
        { name: 'Getting Started', href: '/getting-started', category: 'Docs' },
        { name: 'Manual Setup', href: '/manual-setup', category: 'Docs' },
      ];

      function search(query: string) {
        if (!query.trim()) {
          return [];
        }
        const q = query.toLowerCase();
        return components.filter(c =>
          c.name.toLowerCase().includes(q) ||
          c.category.toLowerCase().includes(q)
        );
      }

      function renderResults(results: typeof components) {
        if (!searchResults) return;

        if (results.length === 0) {
          searchResults.innerHTML = '<p class="text-base-content/50 text-center py-8">No results found</p>';
          return;
        }

        const grouped = results.reduce((acc, item) => {
          if (!acc[item.category]) acc[item.category] = [];
          acc[item.category].push(item);
          return acc;
        }, {} as Record<string, typeof components>);

        searchResults.innerHTML = Object.entries(grouped).map(([category, items]) => `
          <div class="mb-4">
            <div class="text-xs font-semibold uppercase tracking-wider text-base-content/50 mb-2">${category}</div>
            ${items.map(item => `
              <a href="${item.href}" class="block px-3 py-2 rounded-lg hover:bg-base-200 transition-colors">
                ${item.name}
              </a>
            `).join('')}
          </div>
        `).join('');
      }

      searchButton?.addEventListener('click', () => {
        searchModal?.showModal();
        searchInput?.focus();
      });

      // Keyboard shortcut
      document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
          e.preventDefault();
          searchModal?.showModal();
          searchInput?.focus();
        }
        if (e.key === 'Escape' && searchModal?.open) {
          searchModal?.close();
        }
      });

      searchInput?.addEventListener('input', (e) => {
        const query = (e.target as HTMLInputElement).value;
        const results = search(query);
        renderResults(results);
      });

      // Close modal on result click
      searchResults?.addEventListener('click', (e) => {
        if ((e.target as HTMLElement).closest('a')) {
          searchModal?.close();
        }
      });
    </script>
  </body>
</html>
